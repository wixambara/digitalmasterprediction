<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wix Ambara's Blog Post</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8f9fa;
        }
        #article-content {
            font-family: 'Lora', serif;
        }
        /* CSS styling untuk placeholder dihapus agar menyatu dengan teks */
        .prediction-value {
            font-weight: normal; /* Memastikan tidak tebal */
            color: inherit; /* Menggunakan warna teks paragraf */
            background-color: transparent;
            padding: 0;
            border-radius: 0;
        }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <div id="app" class="relative min-h-screen w-full">
        
        <!-- Header -->
        <header id="page-header" class="bg-white/90 backdrop-blur-md sticky top-0 z-20 border-b border-gray-200">
            <div class="max-w-4xl mx-auto px-4 sm:px-6">
                <div class="flex justify-between items-center py-4">
                    <a href="#" class="text-xl font-bold text-gray-900 tracking-tight">Wix Ambara’s Post</a>
                    <nav class="hidden md:flex items-center space-x-8 text-sm font-medium text-gray-600">
                        <a href="#" class="hover:text-blue-600 transition-colors">Home</a>
                        <a href="#" class="hover:text-blue-600 transition-colors">Tentang Saya</a>
                        <a href="#" class="hover:text-blue-600 transition-colors">Kontak</a>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Loader -->
        <div id="loader" class="flex items-center justify-center h-[calc(100vh-200px)]">
            <svg class="animate-spin h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>

        <!-- Article View -->
        <main id="article-container" class="hidden max-w-3xl mx-auto px-4 py-10 sm:px-6 sm:py-16">
            <article class="bg-white p-6 sm:p-10 rounded-xl shadow-sm">
                
                <div class="mb-8 text-center">
                    <h1 id="article-title" class="text-3xl md:text-4xl font-bold text-gray-900 leading-tight mt-2"></h1>
                </div>

                <div class="flex flex-col sm:flex-row justify-between items-center mb-8 border-y border-gray-200 py-4">
                    <div class="flex items-center">
                        <img src="https://placehold.co/40x40/E2E8F0/4A5568?text=WA" alt="Wix Ambara" class="w-10 h-10 rounded-full mr-3">
                        <div>
                            <p class="font-semibold text-gray-800">Wix Ambara</p>
                            <p id="article-date" class="text-sm text-gray-500"></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 mt-4 sm:mt-0">
                        <p class="text-sm text-gray-500 mr-2">Bagikan:</p>
                        <a href="#" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                           <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98-3.56-.18-6.73-1.89-8.84-4.48-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.22-1.95-.55v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06 1.83 1.18 4 1.87 6.36 1.87 7.62 0 11.78-6.3 11.78-11.78l-.02-.53c.8-.58 1.48-1.32 2.02-2.1z"/></svg>
                        </a>
                        <a href="#" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                           <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 24 24"><path d="M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m13 2h-2.5a3.5 3.5 0 0 0-3.5 3.5V11h-2v3h2v7h3v-7h3v-3h-3V8.5A1.5 1.5 0 0 1 16.5 7H18V5z"/></svg>
                        </a>
                    </div>
                </div>

                <div class="mb-8">
                    
                </div>
                
                <div id="article-content" class="text-lg text-gray-800 leading-relaxed space-y-6">
                    <!-- Transformed article content will be injected here -->
                </div>

                <div class="mt-16 border-t border-gray-200 pt-10">
                    <h3 id="comment-title" class="text-2xl font-bold text-gray-900 mb-6">Diskusi</h3>
                    <div id="comment-list" class="space-y-8">
                        <!-- Komentar dari local storage akan muncul di sini -->
                    </div>
                    
                    <div class="mt-12">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Tinggalkan Komentar</h4>
                        <form id="comment-form">
                            <textarea id="comment-input" class="w-full h-24 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Tulis komentar Anda..." required></textarea>
                            <button type="submit" class="mt-3 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">Kirim Komentar</button>
                        </form>
                    </div>
                </div>
            </article>
        </main>

        <footer id="footer" class="hidden border-t border-gray-200 mt-16">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 py-8 text-center text-gray-500 text-sm">
                <p id="copyright-text"></p>
            </div>
        </footer>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCd13i8nOby99JTa2AyhsG_YuFLmj5Bt5s",
            authDomain: "digital-master-prediction.firebaseapp.com",
            projectId: "digital-master-prediction",
            storageBucket: "digital-master-prediction.firebasestorage.app",
            messagingSenderId: "671010231911",
            appId: "1:671010231911:web:1d49fc7aff2cc3b09566c2"
        };
        
        let app, auth, db;
        const FIXED_USER_ID = "wixAmbara";
        const LOCAL_STORAGE_KEY = 'dmp_viewer_data';
        const COMMENTS_STORAGE_KEY = 'dmp_local_comments';

        let localComments = [];

        const DOM = {
            loader: document.getElementById('loader'),
            header: document.getElementById('page-header'),
            articleContainer: document.getElementById('article-container'),
            footer: document.getElementById('footer'),
            copyrightText: document.getElementById('copyright-text'),
            articleTitle: document.getElementById('article-title'),
            articleDate: document.getElementById('article-date'),
            articleContent: document.getElementById('article-content'),
            commentTitle: document.getElementById('comment-title'),
            commentList: document.getElementById('comment-list'),
            commentForm: document.getElementById('comment-form'),
            commentInput: document.getElementById('comment-input'),
        };

        function formatCommentDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('id-ID', {
                day: 'numeric', month: 'long', year: 'numeric',
            });
        }
        
        function renderComments() {
            DOM.commentList.innerHTML = '';
            if (localComments.length > 0) {
                DOM.commentTitle.textContent = `Diskusi (${localComments.length} Komentar)`;
                localComments.forEach(comment => {
                    const commentHTML = `
                        <div class="flex items-start space-x-4">
                            <img src="https://placehold.co/48x48/E2E8F0/4A5568?text=A" alt="User Avatar" class="w-12 h-12 rounded-full">
                            <div>
                                <div class="flex items-center space-x-2">
                                    <p class="font-semibold">${comment.author}</p>
                                    <p class="text-xs text-gray-500">${formatCommentDate(comment.date)}</p>
                                </div>
                                <p class="text-gray-700 mt-1">${comment.text}</p>
                            </div>
                        </div>
                    `;
                    DOM.commentList.insertAdjacentHTML('beforeend', commentHTML);
                });
            } else {
                 DOM.commentTitle.textContent = 'Diskusi';
            }
        }

        function handleCommentSubmit(event) {
            event.preventDefault();
            const commentText = DOM.commentInput.value.trim();
            if (commentText) {
                const newComment = {
                    author: 'Anonymous',
                    text: commentText,
                    date: new Date().toISOString()
                };
                localComments.push(newComment);
                localStorage.setItem(COMMENTS_STORAGE_KEY, JSON.stringify(localComments));
                renderComments();
                DOM.commentInput.value = '';
            }
        }

        function renderArticle(data) {
            const showContent = () => {
                DOM.loader.classList.add('hidden');
                DOM.articleContainer.classList.remove('hidden');
                DOM.footer.classList.remove('hidden');
            };
            
            DOM.copyrightText.textContent = `© ${new Date().getFullYear()} Wix Ambara. All rights reserved.`;

            if (!data || !data.config) {
                DOM.articleTitle.textContent = "Artikel tidak ditemukan";
                DOM.articleContent.textContent = "Silakan atur konten melalui halaman kontrol terlebih dahulu.";
                showContent();
                return;
            }

            const { config, predictions } = data;

            DOM.articleTitle.textContent = config.title || "Tanpa Judul";
            try {
                 DOM.articleDate.textContent = new Date(config.date).toLocaleDateString('id-ID', {
                    year: 'numeric', month: 'long', day: 'numeric'
                });
            } catch (e) {
                DOM.articleDate.textContent = config.date || "";
            }

            let content = config.content || "";
            const finalPredictions = predictions || {};
            const placeholders = [...new Set((content.match(/\$(\w+)/g) || []))];

            placeholders.forEach(placeholderKey => {
                const key = placeholderKey.substring(1);
                const value = finalPredictions[key] || '_____';
                const capitalizedValue = value.charAt(0).toUpperCase() + value.slice(1);
                // PERUBAHAN: Menggunakan <span>, bukan <strong>
                const replacementHtml = `<span class="prediction-value">${capitalizedValue}</span>`;
                content = content.replace(new RegExp(`\\${placeholderKey}`, 'g'), replacementHtml);
            });
            
            DOM.articleContent.innerHTML = content.split('\n').filter(p => p.trim() !== '').map(p => `<p>${p}</p>`).join('');
            showContent();
        }

        async function fetchFromFirebase() {
             try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                await signInAnonymously(auth);
                
                const docRef = doc(db, "artifacts", FIXED_USER_ID);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const serverData = docSnap.data();
                    renderArticle(serverData);
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(serverData));
                } else {
                    renderArticle(null);
                    localStorage.removeItem(LOCAL_STORAGE_KEY);
                }
            } catch (error) {
                console.error("Firebase Init Error:", error);
                renderArticle(null);
            }
        }
        
        async function init() {
            const localDataRaw = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (localDataRaw) {
                try {
                    const localData = JSON.parse(localDataRaw);
                    renderArticle(localData);
                } catch (e) {
                    console.error("Gagal memuat data lokal", e);
                    localStorage.removeItem(LOCAL_STORAGE_KEY);
                    fetchFromFirebase();
                }
            } else {
                fetchFromFirebase();
            }
            
            const savedCommentsRaw = localStorage.getItem(COMMENTS_STORAGE_KEY);
            if (savedCommentsRaw) {
                try {
                    localComments = JSON.parse(savedCommentsRaw);
                } catch (e) {
                    console.error("Gagal memuat komentar lokal", e);
                    localComments = [];
                }
            }
            renderComments();

            DOM.commentForm.addEventListener('submit', handleCommentSubmit);

            let tapCount = 0;
            let lastTapTime = 0;
            DOM.header.addEventListener('click', () => {
                const currentTime = new Date().getTime();
                if (currentTime - lastTapTime < 300) {
                    tapCount++;
                } else {
                    tapCount = 1;
                }
                lastTapTime = currentTime;

                if (tapCount === 3) {
                    localStorage.removeItem(LOCAL_STORAGE_KEY);
                    window.location.reload();
                }
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>